#!/bin/bash

show_help() {
    cat << 'EOF'
ðŸ“ Text File Dumper - Combine all your text files into one

Usage:
  ./dump                       # Show this help
  ./dump .                     # Dump current folder
  ./dump notes/                # Dump 'notes' folder  
  ./dump notes/ all.txt        # Custom output name
  ./dump . backup.txt .txt .md # Only .txt and .md files

Simple and friendly! ðŸš€
EOF
}

# Show help if no args or -h
[[ $# -eq 0 || "$1" == "-h" || "$1" == "--help" ]] && { show_help; [[ $# -eq 0 ]] && echo "ðŸ’¡ Run with arguments to dump files"; exit 0; }

# Parse args: directory, output, file_types
DIR=${1:-.}; shift
OUT=${1:-dump.txt}; [[ "$OUT" == .* ]] && { OUT=dump.txt; } || shift
TYPES=("$@")

# Validate directory
[[ ! -d "$DIR" ]] && { echo "âŒ Directory '$DIR' not found"; exit 1; }

echo "ðŸ“ Dumping text files from '$DIR' to '$OUT'"
[[ ${#TYPES[@]} -gt 0 ]] && echo "ðŸŽ¯ Filtering for: ${TYPES[*]}"

rm -f "$OUT"
count=0

find "$DIR" -type f ! -name "$OUT" ! -name "dump" ! -name "*.py" ! -name "*.sh" | while read -r file; do
    # Filter by types if specified
    if [[ ${#TYPES[@]} -gt 0 ]]; then
        match=false
        for type in "${TYPES[@]}"; do [[ "$file" == *"$type" ]] && { match=true; break; }; done
        [[ "$match" == false ]] && continue
    fi
    
    # Check if text file and process
    [[ $(file -b --mime-type "$file") == text/* ]] && {
        rel="${file#$DIR/}"; [[ "$rel" == "$file" ]] && rel="$(basename "$file")"
        echo "  âœ“ $rel"
        { echo "--- $(basename "$file") ($(dirname "$rel")) ---"; cat "$file"; echo "--- End of $(basename "$file") ---"; echo; } >> "$OUT"
        ((count++))
    }
done

[[ -f "$OUT" ]] && { count=$(grep -c "^--- .* ---$" "$OUT" 2>/dev/null || echo 0); echo "ðŸ“„ Created '$OUT' with $count files"; } || echo "ðŸ“„ No text files found"
echo "ðŸŽ‰ Done!"